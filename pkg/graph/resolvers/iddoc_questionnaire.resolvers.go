package resolvers

// This file will be automatically regenerated based on the schema, any resolver implementations
// will be copied through when generating and any unknown code will be moved to the end.
// Code generated by github.com/99designs/gqlgen

import (
	"context"

	"github.com/google/uuid"

	"github.com/cms-enterprise/mint-app/pkg/appcontext"
	"github.com/cms-enterprise/mint-app/pkg/graph/generated"
	"github.com/cms-enterprise/mint-app/pkg/graph/model"
	"github.com/cms-enterprise/mint-app/pkg/models"
)

// DataMonitoringFileTypes is the resolver for the dataMonitoringFileTypes field.
func (r *iDDOCQuestionnaireResolver) DataMonitoringFileTypes(ctx context.Context, obj *models.IDDOCQuestionnaire) ([]models.IDDOCFileType, error) {
	return obj.DataMonitoringFileTypes, nil
}

// DataFullTimeOrIncremental is the resolver for the dataFullTimeOrIncremental field.
func (r *iDDOCQuestionnaireResolver) DataFullTimeOrIncremental(ctx context.Context, obj *models.IDDOCQuestionnaire) (*model.IDDOCFullTimeOrIncrementalType, error) {
	if obj.DataFullTimeOrIncremental == nil {
		return nil, nil
	}
	value := model.IDDOCFullTimeOrIncrementalType(*obj.DataFullTimeOrIncremental)
	return &value, nil
}

// Status is the resolver for the status field.
func (r *iDDOCQuestionnaireResolver) Status(ctx context.Context, obj *models.IDDOCQuestionnaire) (model.IDDOCQuestionnaireStatus, error) {
	// If not needed, return NOT_NEEDED
	if !obj.Needed {
		return model.IDDOCQuestionnaireStatusNotNeeded, nil
	}

	// If completed, return COMPLETED
	if obj.CompletedDts != nil {
		return model.IDDOCQuestionnaireStatusCompleted, nil
	}

	// If any field has been modified after creation (excluding metadata), return IN_PROGRESS
	if obj.ModifiedDts != nil && !obj.ModifiedDts.Equal(obj.CreatedDts) {
		return model.IDDOCQuestionnaireStatusInProgress, nil
	}

	// Otherwise, return NOT_STARTED
	return model.IDDOCQuestionnaireStatusNotStarted, nil
}

// UpdateIDDOCQuestionnaire is the resolver for the updateIDDOCQuestionnaire field.
func (r *mutationResolver) UpdateIDDOCQuestionnaire(ctx context.Context, id uuid.UUID, changes map[string]any) (*models.IDDOCQuestionnaire, error) {
	logger := appcontext.ZLogger(ctx)
	principal := appcontext.Principal(ctx)

	return IDDOCQuestionnaireUpdate(
		ctx,
		logger,
		id,
		changes,
		principal,
		r.store,
		r.emailService,
		r.addressBook,
	)
}

// IDDOCQuestionnaire returns generated.IDDOCQuestionnaireResolver implementation.
func (r *Resolver) IDDOCQuestionnaire() generated.IDDOCQuestionnaireResolver {
	return &iDDOCQuestionnaireResolver{r}
}

type iDDOCQuestionnaireResolver struct{ *Resolver }
