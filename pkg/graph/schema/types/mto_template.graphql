# Mirror of DB enum MTOTemplateKey
enum MTOTemplateKey {
  ACO_AND_KIDNEY_MODELS
  EPISODE_PRIMARY_CARE_AND_NON_ACO_MODELS
  MEDICARE_ADVANTAGE_AND_DRUG_MODELS
  STANDARD_CATEGORIES
  STATE_AND_LOCAL_MODELS
}

type MTOTemplate {
  id: UUID!
  key: MTOTemplateKey!
  name: String!
  description: String
  dateAdded: Time

  # Custom Resolvers
  """
  To represent if this template is _already_ part of the Model Plan's MTO.
  This will automatically return false if it is not in the context of a model plan
  """
  isAdded: Boolean!
  categories: [MTOTemplateCategory!]!
  milestones: [MTOTemplateMilestone!]!
  solutions: [MTOTemplateSolution!]!

  # Convenience count fields
  primaryCategoryCount: Int!
  categoryCount: Int!
  milestoneCount: Int!
  solutionCount: Int!

  createdBy: UUID!
  createdDts: Time!
  modifiedBy: UUID
  modifiedDts: Time
}

type MTOTemplateCategory {
  id: UUID!
  templateID: UUID!
  name: String!
  order: Int!

  # Custom Resolvers
  isUncategorized: Boolean!
  subCategories: [MTOTemplateSubCategory!]!

  createdBy: UUID!
  createdDts: Time!
  modifiedBy: UUID
  modifiedDts: Time
}

type MTOTemplateSubCategory {
  id: UUID!
  templateID: UUID!
  name: String!
  parentID: UUID
  order: Int!

  # Custom Resolvers
  milestones: [MTOTemplateMilestone!]!

  createdBy: UUID!
  createdDts: Time!
  modifiedBy: UUID
  modifiedDts: Time
}

type MTOTemplateMilestone {
  id: UUID!
  name: String!
  key: MTOCommonMilestoneKey
  templateID: UUID!
  mtoTemplateCategoryID: UUID

  # Custom Resolvers
  solutions: [MTOTemplateSolution!]!

  createdBy: UUID!
  createdDts: Time!
  modifiedBy: UUID
  modifiedDts: Time
}

type MTOTemplateSolution {
  id: UUID!
  name: String!
  key: MTOCommonSolutionKey
  templateID: UUID!
  mtoCommonSolutionID: UUID!

  # Custom Resolvers
  milestones: [MTOTemplateMilestone!]!

  createdBy: UUID!
  createdDts: Time!
  modifiedBy: UUID
  modifiedDts: Time
}

type ApplyTemplateResult {
  id: UUID!
  modelPlanID: UUID!
  templateID: UUID!
  categoriesAdded: Int!
  milestonesAdded: Int!
  solutionsAdded: Int!
  warnings: [String!] # Non-blocking messages returned when applying a template.
}

extend type Query {
  # List all templates (optionally filter by keys)
  mtoTemplates(keys: [MTOTemplateKey!]): [MTOTemplate!]!

  # Get a single template by id or key
  mtoTemplate(id: UUID, key: MTOTemplateKey): MTOTemplate
}

extend type Mutation {
  # Apply a template to a specific MTO (matrix)
  createTemplateToMTO(
    modelPlanID: UUID!
    templateID: UUID!
  ): ApplyTemplateResult!
}
